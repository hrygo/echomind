# ğŸ“± Design Spec: EchoMind v0.8.0 "WeChat Connect"

> **Code Name**: The Portable Brain
> **Target Version**: v0.8.0
> **Status**: **Approved Spec**
> **Core Philosophy**: "Lazy Intelligence" (æ‡’äººæ™ºèƒ½) â€” Zero Friction, High Context.

---

## 1. æ„¿æ™¯ä¸å™äº‹ (Vision & Narrative)

v0.8.0 ä¸æ˜¯ä¸ºäº†è®©ç”¨æˆ·åœ¨å¾®ä¿¡é‡Œâ€œå·¥ä½œâ€ï¼Œè€Œæ˜¯ä¸ºäº†**æŠŠç”¨æˆ·ä»ç”µè„‘å‰è§£æ”¾å‡ºæ¥**ã€‚
å¾®ä¿¡ç«¯çš„äº¤äº’é€»è¾‘éµå¾ª **"Fire and Forget" (å‘å°„å³å¿˜)** åŸåˆ™ã€‚

### ğŸŒ¤ï¸ A Day in the Life (ç”¨æˆ·æ•…äº‹)

*   **08:30 (Commute)**: æ‰‹æœºéœ‡åŠ¨ã€‚EchoMind æ¨é€ **"Morning Briefing"**ã€‚ä½ æ‰«äº†ä¸€çœ¼ï¼š3 ä¸ªå¾…åŠï¼Œ1 ä¸ªç´§æ€¥é£é™©ã€‚ä½ ä¸éœ€è¦å›å¤ï¼Œå¿ƒé‡Œæœ‰æ•°äº†ã€‚
*   **10:00 (Meeting)**: ä¼šè®®é—´éš™ï¼Œä½ çªç„¶æƒ³åˆ°ä¸€ä¸ªç»ä½³çš„ç‚¹å­ã€‚ä½ æ‹¿èµ·æ‰‹æœºï¼ŒæŒ‰ä½è¯´è¯ï¼š*"è®°ä¸€ä¸‹ï¼ŒæŠŠé¦–é¡µçš„ CTA æŒ‰é’®æ”¹æˆåŠ¨æ€å‘¼å¸æ•ˆæœï¼Œä¸‹å‘¨ä¸€è®¾è®¡è¯„å®¡æ—¶æå‡ºæ¥ã€‚"* **(Thought Catcher)**ã€‚
*   **14:00 (Focus Time)**: å¾®ä¿¡æ”¶åˆ°ä¸€æ¡å¤æ‚çš„åˆä½œå’¨è¯¢ã€‚ä½ ç›´æ¥è½¬å‘ç»™ EchoMindï¼š*"æŸ¥ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰å’Œè¿™å®¶å…¬å¸çš„å†å²æŠ¥ä»·ï¼Œç„¶åæ‹Ÿä¸€ä¸ªå§”å©‰çš„æ‹’ç»å›å¤ï¼Œè¯´æˆ‘ä»¬äº§èƒ½æ»¡äº†ã€‚"* **(RAG + Draft)**ã€‚
*   **16:00 (Chaos)**: ä¸‹å±é—®ï¼š"è€æ¿ï¼Œä¸‹å‘¨äºŒä¸‹åˆ 3 ç‚¹èƒ½å¼€ä¼šå—ï¼Ÿ" ä½ æŠŠè¿™å¥è¯è½¬å‘ç»™ EchoMindã€‚EchoMind ç§’å›ï¼š*"å†²çªé¢„è­¦ (æœ‰è´¢åŠ¡ä¼š)ã€‚å»ºè®®å›å¤ï¼šå‘¨ä¸‰ä¸Šåˆ 10 ç‚¹æˆ–å‘¨äºŒ 4 ç‚¹åŠåã€‚"* ä½ ç‚¹å‡» **[å¤åˆ¶å»ºè®®]** å‘é€ã€‚ **(Calendar Gatekeeper)**ã€‚
*   **20:00 (Vacation)**: ä½ åœ¨åº¦å‡ã€‚EchoMind æ‹¦æˆªäº† 50 å°é‚®ä»¶ï¼Œåªæœ‰ä¸€å°æ­¤æ—¶çªç ´é™éŸ³å‘å‡ºçº¢è‰²è­¦æŠ¥ï¼š*"å¤§å®¢æˆ· CEO å‘é‚®ä»¶è¯´è¦è§£çº¦"*ã€‚ä½ ç‚¹å‡»å¡ç‰‡ä¸‹çš„ **[ ğŸ“ é¢„çº¦æ˜å¤©ç”µè¯ ]**ã€‚ **(One-Touch Decision)**ã€‚

---

## 2. æ ¸å¿ƒåŠŸèƒ½è§„æ ¼ (Functional Specifications)

### 2.1 ğŸ™ï¸ The Voice Commander (è¯­éŸ³æŒ‡æŒ¥å®˜)
**å®šä¹‰**: åˆ©ç”¨å¾®ä¿¡åŸç”Ÿè¯­éŸ³èƒ½åŠ›ï¼Œç»“åˆ OpenAI Whisperï¼Œå®ç°é«˜ç²¾åº¦è‡ªç„¶è¯­è¨€äº¤äº’ã€‚

*   **äº¤äº’æµç¨‹**:
    1.  ç”¨æˆ·å‘é€è¯­éŸ³ (æ”¯æŒä¸­è‹±æ··æ‚ã€æ–¹è¨€)ã€‚
    2.  EchoMind æŠ“å– `MediaID`ï¼Œä¸‹è½½éŸ³é¢‘ã€‚
    3.  è°ƒç”¨ **Whisper API** è½¬å½•ä¸ºæ–‡æœ¬ã€‚
    4.  **Intent Classification (æ„å›¾è¯†åˆ«)**:
        *   `INTENT_SEARCH`: "æŸ¥ä¸€ä¸‹..." -> è°ƒç”¨ RAG -> è¿”å›æ–‡æœ¬æ‘˜è¦ã€‚
        *   `INTENT_DRAFT`: "å›å¤è¯´..." -> ç”Ÿæˆè‰ç¨¿ -> è¿”å›ç¡®è®¤å¡ç‰‡ã€‚
        *   `INTENT_TASK`: "æé†’æˆ‘..." -> åˆ›å»º Task -> è¿”å› "å·²è®°å½•"ã€‚
        *   `INTENT_READ`: "è¯»ä¸€ä¸‹è¿™å°ä¿¡" -> TTS ç”Ÿæˆè¯­éŸ³ -> å‘é€ MP3 ç»™ç”¨æˆ·ã€‚

### 2.2 ğŸ—“ï¸ The Calendar Gatekeeper (æ—¥ç¨‹å®ˆé—¨äºº)
**å®šä¹‰**: æ™ºèƒ½å†²çªæ£€æµ‹ä¸è‡ªåŠ¨åå•†ä»£ç†ã€‚

*   **è§¦å‘æ–¹å¼**:
    *   ç”¨æˆ·è½¬å‘åŒ…å«æ—¶é—´çš„æ–‡æœ¬/å›¾ç‰‡ç»™å…¬ä¼—å·ã€‚
    *   ç”¨æˆ·ç›´æ¥è¯¢é—®ï¼š"æ˜å¤©ä¸‹åˆæˆ‘æœ‰ç©ºå—ï¼Ÿ"
*   **æ™ºèƒ½é€»è¾‘**:
    1.  **NER (å®ä½“è¯†åˆ«)**: æå–æ—¶é—´æ§½ (e.g., "Next Tuesday 3 PM").
    2.  **Conflict Check**: æŸ¥è¯¢ç”¨æˆ·æ—¥å† (Google/Outlook/Internal DB)ã€‚
    3.  **Slot Finding**: å¦‚æœå†²çªï¼Œå‘åå¯»æ‰¾æœ€è¿‘çš„ 2 ä¸ªç©ºé—² 30min+ æ—¶é—´æ§½ã€‚
    4.  **Response Gen**: ç”Ÿæˆç¬¦åˆç”¨æˆ·å£å»çš„å›å¤å»ºè®®ã€‚
*   **Output**: 
    > ğŸš« **å†²çª**: è´¢åŠ¡æ±‡æŠ¥ (14:30-16:00)
    > âœ… **å»ºè®®å›å¤**: "å‘¨äºŒä¸‹åˆä¸è¡Œï¼Œå‘¨ä¸‰ä¸Šåˆ10ç‚¹æ–¹ä¾¿å—ï¼Ÿ"

### 2.3 ğŸ§  The Thought Catcher (çµæ„Ÿæ•æ‰‹)
**å®šä¹‰**: æé€Ÿçš„ Memo å½•å…¥å…¥å£ã€‚

*   **ç‰¹ç‚¹**: ä¸åªæ˜¯è®°å½•æ–‡å­—ï¼Œè¿˜è¿›è¡Œ**ç»“æ„åŒ–å¤„ç†**ã€‚
*   **Example**:
    *   Input: "è®°å¾—ä¸‹å‘¨ç»™ç‹æ€»å¯„åˆåŒã€‚"
    *   Processing: æå– `Action: å¯„åˆåŒ`, `Person: ç‹æ€»`, `Due: Next Week`ã€‚
    *   Output: "å·²åˆ›å»ºä»»åŠ¡ [å¯„åˆåŒ - ç‹æ€»] ğŸ“… ä¸‹å‘¨ä¸€ 09:00ã€‚"
*   **Sync**: åŒæ­¥è‡³ Web ç«¯ Dashboard çš„ "Tasks" åŒºåŸŸã€‚

### 2.4 âš¡ One-Touch Decision (ä¸€é”®å†³ç­–)
**å®šä¹‰**: å°†å¤æ‚é‚®ä»¶è½¬åŒ–ä¸ºç®€å•çš„äºŒå…ƒé€‰é¡¹ã€‚

*   **åœºæ™¯**: å®¡æ‰¹ã€ä¼šè®®é‚€è¯·ã€ç®€å•ç¡®è®¤ã€‚
*   **UI (Template Message)**:
    ```text
    ã€å®¡æ‰¹è¯·æ±‚ã€‘Q4 è¥é”€é¢„ç®—
    ç”³è¯·äººï¼šAlice
    é‡‘é¢ï¼šÂ¥500,000 (è¶…é¢„ç®— 10%)
    é£é™©ï¼šé«˜
    ----------------
    [ ğŸŸ¢ æ‰¹å‡† ]  [ ğŸ”´ é©³å› ] [ ğŸ’¬ ç¨åå¤„ç† ]
    ```
*   **Action**: ç‚¹å‡»æŒ‰é’®ç›´æ¥è°ƒç”¨ API å®Œæˆæ“ä½œï¼Œå¹¶åœ¨å¾®ä¿¡å†…åé¦ˆ "âœ… å·²æ‰¹å‡†"ã€‚

---

## 3. å¾®ä¿¡å…¬ä¼—å·èœå•æ¶æ„ (Menu Map)

```text
+----------------+----------------+----------------+
|  ğŸš€ ä»Šæ—¥æ¦‚è§ˆ   |   ğŸ§  ç¬¬äºŒå¤§è„‘  |    âš™ï¸ æˆ‘çš„     |
+----------------+----------------+----------------+
| ğŸ“° æ™¨æŠ¥ (Brief)| ğŸ” æœé‚®ä»¶      | ğŸ”— è´¦å·ç»‘å®š    |
| ğŸ“‹ å¾…åŠ (Tasks)| ğŸ™ï¸ è®°çµæ„Ÿ      | ğŸ”• å…æ‰“æ‰°æ¨¡å¼  |
| ğŸ—“ï¸ æ—¥ç¨‹ (Cal)  | ğŸ“‡ æŸ¥äººè„‰      | ğŸ†˜ å¸¸ç”¨æŒ‡ä»¤    |
+----------------+----------------+----------------+
```

---

## 4. æŠ€æœ¯æ¶æ„ä¸æŒ‘æˆ˜ (Technical Architecture)

### 4.1 æ¶ˆæ¯å¤„ç†ç®¡é“ (Pipeline)
```mermaid
graph LR
    WeChat_Server -->|XML/POST| Gateway_Svc
    Gateway_Svc -->|Async| Task_Queue[Redis/Asynq]
    
    subgraph Workers
        Audio_Worker -->|Audio| Whisper_API
        NLP_Worker -->|Text| DeepSeek_LLM
        Action_Worker -->|Intent| Backend_API
    end
    
    Task_Queue --> Workers
    Workers -->|Reply| WeChat_Sender
```

### 4.2 ä¼šè¯çŠ¶æ€ç®¡ç† (Session State)
ç”±äºå¾®ä¿¡äº¤äº’æ˜¯æ— çŠ¶æ€çš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Redis ä¸­ç»´æŠ¤ FSM (æœ‰é™çŠ¶æ€æœº)ã€‚
*   **Key**: `wx_session:{openid}`
*   **TTL**: 5 minutes
*   **States**:
    *   `IDLE`: ç©ºé—²ã€‚
    *   `AWAIT_SEARCH_QUERY`: ç”¨æˆ·ç‚¹å‡»äº†â€œæœé‚®ä»¶â€ï¼Œç­‰å¾…è¾“å…¥å…³é”®è¯ã€‚
    *   `AWAIT_REPLY_CONFIRM`: AI ç”Ÿæˆäº†è‰ç¨¿ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤å‘é€ã€‚

### 4.3 è´¦å·å®‰å…¨ (Security)
*   **Binding**: é‡‡ç”¨ **QRCode Scenarios (å¸¦å‚äºŒç»´ç )**ã€‚
    1.  Web ç«¯ç”Ÿæˆå¸¦ `uuid` çš„äºŒç»´ç ã€‚
    2.  ç”¨æˆ·å¾®ä¿¡æ‰«ç ã€‚
    3.  å¾®ä¿¡å›è°ƒ Serverï¼ŒServer å°† `openid` ä¸ `uuid` (User ID) ç»‘å®šã€‚
*   **Verify**: æ¯æ¬¡è¯·æ±‚æ ¡éªŒ `openid` æ˜¯å¦å­˜åœ¨äºç»‘å®šè¡¨ã€‚

---

## 5. å®æ–½è·¯çº¿å›¾ (Implementation Roadmap)

### Phase 1: åŸºç¡€è®¾æ–½ (v0.8.0-alpha)
*   [ ] ç”³è¯·å¾®ä¿¡æœåŠ¡å· (Service Account)ï¼Œé…ç½®æœåŠ¡å™¨ URLã€‚
*   [ ] å®ç° `WeChatGateway` (æ¥æ”¶ XMLï¼ŒéªŒè¯ç­¾å)ã€‚
*   [ ] å®ç° `AccountBinding` (äºŒç»´ç ç»‘å®šé€»è¾‘)ã€‚

### Phase 2: æ ¸å¿ƒäº¤äº’ (v0.8.0-beta)
*   [ ] é›†æˆ Whisper API å¤„ç†è¯­éŸ³ã€‚
*   [ ] å®ç° LLM Intent Router (æ„å›¾åˆ†ç±»å™¨)ã€‚
*   [ ] å¼€å‘ "Morning Briefing" æ¨é€ Jobã€‚

### Phase 3: é«˜çº§æ™ºèƒ½ (v0.8.0-RC)
*   [ ] é›†æˆæ—¥å† API (Calendar Gatekeeper)ã€‚
*   [ ] å®ç° RAG Search çš„å¾®ä¿¡ç«¯é€‚é… (ç²¾ç®€è¾“å‡º)ã€‚
*   [ ] å‹åŠ›æµ‹è¯•ä¸ Token æˆæœ¬ä¼˜åŒ–ã€‚